---
title: "BS_HW4"
author: "Kirienko Nadezhda"
date: "2024-04-03"
output: html_document
---
ДЗ 4. Использование основных статистических тестов и поправок на множественные сравнения
**Задание 1** 
Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size <- 30. Задайте значение среднего артериального давления до приема нового препарата и после.
  1. Импортирую требуемые библиотеки
```{r}
library(ggplot2)
library(tidyverse)
library(car)
```
2.Задаю seed, размер выборки, значения артериального давления до приема нового препарата и после.
  генерируюданные в обеих выборках (нормальное распределение, задаю SD)
  формирую из обеих выборок датасет и контроль содержания первых 6 строк
```{r}
set.seed(11)
sample_size <- 30
mean_pressure_before <- 150  
mean_pressure_after <- 130 

sd_pressure <- 14
pressure_before <- rnorm(sample_size, mean_pressure_before, sd_pressure)

sd_pressure_after <- 8
pressure_after <- rnorm(sample_size, mean_pressure_after, sd_pressure_after)

pressure <- data.frame(Pressure_Before = pressure_before,
                            Pressure_After = pressure_after)
head(pressure)
```
**Затем:**

Сформулируйте нулевую и альтернативную гипотезы.
Определите уровень значимости.
Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
Определите наблюдаемое значение статистики, а также критическое значение статистики.
Оцените и прокомментируйте статистическую значимость.

Н0- Отсутствует различие между артериальным давлением до и после приема препарата
Н1- Имеется различие между артериальным давлением до и после приема нового препарата
уровень значимости - 0,05

для определения теста для проверки гипотезы - предварительно определяю тип распределения данных по каждой переменной
(строю гистограмму и применяю тест Шапиро-Уилка)
```{r}
ggplot(pressure, aes(x = Pressure_Before)) +
  geom_histogram(binwidth = 5,fill = "blue", color = "black") +
  labs(title = "Гистограмма распределения АД до приема нового препарата", x = "Значения", y = "Частота") +
  theme_minimal()
```


```{r}
ggplot(pressure, aes(x = Pressure_After)) +
  geom_histogram(binwidth = 5, fill = "green", color = "black") +
  labs(title = "Гистограмма распределения артериального давления после приема препарата", x = "Значения", y = "Частота") +
  theme_minimal()
```
```{r}
shapiro.test(pressure$Pressure_Before)
shapiro.test(pressure$Pressure_After)
```
По анализу обеих гистограмм распределение с трудом можно определить как нормальное.
По результатам теста Шапиро-Уилка: p-value (0.4397, 0.6378) больше чем заданный уровень значимости (0,05) - поэтому отвергнуть нулевую гипотезу (распределение в обеих выборках нормальное)
Вывод : применяю парный T-test (зависимая выборка, нормальное распределение, количественные переменные) 
```{r}
mean(pressure$Pressure_Before)
mean(pressure$Pressure_After)
t.test(pressure$Pressure_Before, pressure$Pressure_After, paired = TRUE)
```
```{r}
alpha = 0.05
qt(1 - alpha/2, df = 29)
```
По результатам t-test : p-value = 1.35e-07
                        95% доверительный интервал 11.14 - 20.50
                        средняя разница между значениями - 15.82
                        количество степеней свободы - 29
                        значение t-статистики 6.91

Таким образом наблюдаемое значение статистики (6.91)превышает критическое значение 2.05 для 29 степеней свободы на уровне значимости 0.05.

p-value (1.35e-07) < alpha (0,05) , поэтому  нулевая гипотеза отвергается и принимается альтернативная :  Имеется различие между артериальным давлением до и после приема нового препарата
Вывод: Новый препарат имеет эффект в снижении артериального давления в сравнении со стандартной терапией.



**Задание 2**
Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

Рассмотрите два случая: для выборки sample_size1 <- 100 и выборки sample_size2 <- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

1. Сознаю две выборки по заданным условиям (вектор - курящие 1, некурящие 0)
2. Генерирую данные рака легких для курящих и некурящих, объединяю их и создаю датафрейм
```{r}
sample_size1 <- 100
smoking_status <- rep(c(1, 0), each = (sample_size1 / 2))

set.seed(11) 
cancer_smoker <- rbinom((sample_size1 / 2), 1, 0.8)
cancer_nonsmoker <- rbinom((sample_size1 / 2), 1, 0.2)

sum_cancer <- c(cancer_smoker, cancer_nonsmoker)
sample100 <- data.frame(Smoking = smoking_status,
                        SumCancer = sum_cancer)

head(sample100)
```
```{r}
sample_size2 <- 30
smoking_status <- rep(c(1, 0), each = (sample_size2 / 2))

set.seed(15) 
cancer_smoker <- rbinom((sample_size2 / 2), 1, 0.8)
cancer_nonsmoker <- rbinom((sample_size2 / 2), 1, 0.2)

sum_cancer <- c(cancer_smoker, cancer_nonsmoker)

sample30 <- data.frame(Smoking = smoking_status,
                        SumCancer = sum_cancer)

head(sample30)
```
**Затем:**

Сформулируйте нулевую и альтернативную гипотезы.
Определите уровень значимости.
Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
Определите наблюдаемое значение статистики, а также критическое значение статистики.
Оцените и прокомментируйте статистическую значимость.


Н0- Отсутствует разница в вероятности развития рака легких  у курящих и некурящих
Н1- Имеется разница в вероятности развития рака легких  у курящих и некурящих
уровень значимости - 0,05

для определения теста для проверки гипотезы - предварительно определяю тип распределения данных по каждой переменной (диаграмма)

```{r}
barplot(table(sample100$Smoking, sample100$SumCancer), beside = TRUE,
        col = c("green", "red"), legend = c("Рака легких НЕТ", "Рак легких ЕСТЬ"),
        names.arg = c("Некурящие", "Курящие"), main = "Рак легких у курящих и некурящих людей (sample 100)",
        ylab = "Количество наблюдений")

```
```{r}
barplot(table(sample30$Smoking, sample30$SumCancer), beside = TRUE,
        col = c("green", "red"), legend = c("Рака легких НЕТ", "Рак легких ЕСТЬ"),
        names.arg = c("Некурящие", "Курящие"), main = "Рак легких у курящих и некурящих людей (sample 30)",
        ylab = "Количество наблюдений")
```
Анализ диаграмм обеих выборок: распределение события (рак легких) в обеих выборках неравномерно, переменные категориальные,независимые наблюдения
С учетом вышеописанных критериев проводим далее тест Фишера для обеих выборок (гипотеза альтернативная)
```{r}
contingency_table100 <- table(sample100$Smoking, sample100$SumCancer)
fisher_test100 <- fisher.test(contingency_table100, alternative = "greater")
fisher_test100
```
```{r}
contingency_table30 <- table(sample30$Smoking, sample30$SumCancer)
fisher_test_result30 <- fisher.test(contingency_table30, alternative = "greater")
fisher_test_result30
```
Результатом теста Фишера - является значение p-value, значения статистики не оцениваю.
Оценка  теста Фишера:
Первая выборка (100 наблюдений):p-value = 2.31e-15; 95% доверительный интервал - 17.02 - бесконечность, отношение шансов - 51.43
Вторая выборка (30 наблюдений):p-value = 0.0328; 95% доверительный интервал - 1.15 - бесконечность, отношение шансов - 5.16

В обеих выборках p-value (2.31e-15,0.0328) меньше чем установленный уровень значимости (0,05), следовательно отвергаю нулевую гипотезу и принимаю альтеранивную - Имеется разница в вероятности развития рака легких  у курящих и некурящих


**Задание 3** 
Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.
1. Сформирую выборки (treat, diet) размером 60, определю отклонения для каждой , объединяю в датасет 
```{r}
set.seed(30)
sample_size <- 60

mean_treat <- 4
sd_treat <- 2
mean_diet <- 4
sd_diet <- 2

treat_group <- round(rnorm(sample_size, mean_treat, sd_treat))
diet_group <- round(rnorm(sample_size, mean_diet, sd_diet))

treat <- data.frame(New_method = treat_group,
                            Diet = diet_group)
head(treat)
```
Н0- Отсутствует разница между эффектом лечения новым методом и диетотерапией
Н1- Имеется разница между эффектом лечения новым методом и диетотерапией
уровень значимости - 0,05

По условию - выборки независимы и имеют одинаковое распределение - используем тест Манна -Уитни
```{r}
result <- wilcox.test(treat_group, diet_group, alternative = "two.sided", exact = FALSE)
result
```
Оценка теста: 
Наблюдаемое значение статистики (W): 1423
Критическое значение статистики для теста Манна-Уитни зависит от размера выборок и не указывается напрямую в выводе теста. 
p-value = 0.04568
p-value (0.04568) меньше чем установленный уровень значимости (0,05), следовательно отвергаю нулевую гипотезу и принимаю альтеранивную - Имеется разница между эффектом лечения новым методом и диетотерапией



*Задание 4* 
Рассмотрите следующую гипотезу.

Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.

Сгенерируйте датасет следующим образом:
```{r}
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
```
Формулирую гипотезы
H0- нет  различий между размером опухоли в 3 выборках
H1-есть  различия между размером опухоли в 3 выборках
alpha = 0.05

`
**Далее задания**
1. Постройте на одном графике три «ящика с усами» для наглядности.
```{r}
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(title = "Размер опухоли в зависимости от препарата", x = "Терапия", y = "Размер опухоли") +
  theme_minimal()
```
2. Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах. 
- Прокомментируйте получившийся результат.
```{r}
aov_model <- aov(value ~ therapy, data = tumor)
summary(aov_model)
```
  * F-значение: 1.176
  * P-значение: 0.324
  * Статистическая значимость: Различия между группами не являются статистически значимыми на уровне значимости 0.05.
  p-value (0.324) больше чем установленный уровень значимости (0,05), следовательно нулевую гипотезу не отвергаю -нет  различий между размером опухоли в 3 выборках
Вывод: отсуствует значимое влияние противоопухолевых препаратов A и B по сравнению с плацебо на размер опухоли.



3. С помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки.
- Прокомментируйте получившийся результат.
```{r}
tukey_results <- TukeyHSD(aov_model, confV.level = 0.95)
print(tukey_results)
```

Результаты теста Тьюки: анализирум `p-adjusted` для всех сравнений
Во группе A-0 `p-adjusted > alpha`, значит мы не можем отклонить нулевую гипотезу - нет  различий между размером опухоли в 3 выборках
Во группах  В-0 и В-А  `p-adjusted < alpha`, значит мы  можем отклонить нулевую гипотезу и принять альтернативную  - есть  различий между размером опухоли в 3 выборках
Вывод:
Попарные сравнения показывают, что нет статистически значимых различий между группами терапии A и плацебо и присуствуют статистически значимые различия между размерами опухоли в группах В-0 и В-А. ЧТо возможно свидетельствует об эффективности препрата В в отношении размера клеток против А и плацебо
